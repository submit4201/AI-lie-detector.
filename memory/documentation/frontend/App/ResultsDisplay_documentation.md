# ResultsDisplay Component Documentation

This document provides an overview of the `ResultsDisplay` component located in `frontend/src/components/App/ResultsDisplay.jsx`. This component is central to showcasing the outcomes of the AI-powered analysis to the user.

---

## Purpose

The `ResultsDisplay` component is responsible for rendering the various analysis results generated by the backend. It handles different states:
*   **Loading**: Displays a spinner and progress messages while analysis is in progress.
*   **Error**: Shows an error message if the analysis fails.
*   **No Results**: Displays a placeholder when no analysis has been performed or no results are available.
*   **Streaming Results**: Dynamically updates to show partial results as they arrive during streaming analysis, indicating which components have been received.
*   **Complete Results**: Renders a comprehensive view of all analysis sections once the analysis is complete (or for non-streaming results).

It uses several specialized sub-components to structure and display different facets of the analysis.

---

## Key Props Accepted

*   **`analysisResults: Object | null`**:
    *   The main object containing all analysis data when not streaming or when streaming is complete.
*   **`isLoading: boolean`**:
    *   Indicates if the primary analysis (traditional or initial phase of streaming) is in progress.
*   **`error: string | null`**:
    *   An error message string if an error occurred during analysis.
*   **`getCredibilityColor: (score: number) => string`** (Likely, based on `KeyHighlightsSection` usage):
    *   A utility function to determine the color associated with a credibility score.
*   **`getCredibilityLabel: (score: number) => string`** (Likely, based on `KeyHighlightsSection` usage):
    *   A utility function to get a textual label for a credibility score.
*   **`sessionHistory: Array<Object>`**:
    *   An array of past analysis entries for the current session, used by `SessionHistorySection` and `SessionInsightsSection`.
*   **`sessionId: string | null`**:
    *   The ID of the current active session.
*   **`isStreaming: boolean`** (Default: `false`):
    *   Indicates if the current analysis is in streaming mode.
*   **`streamingProgress: string`** (Default: `"Processing..."`):
    *   A message indicating the current step or progress of the streaming analysis.
*   **`partialResults: Object | null`** (Default: `null`):
    *   An object that accumulates results as they arrive during streaming.
*   **`lastReceivedComponent: string | null`** (Default: `null`):
    *   The key of the most recently received analysis component during streaming (e.g., "transcript", "emotion_analysis"). Used for highlighting.
*   **`componentsReceived: Array<string>`** (Default: `[]`):
    *   A list of keys for analysis components that have been received during streaming.

---

## Structure and Content Display

The component uses conditional rendering extensively to adapt to different states.

### 1. Error State
*   If `error` prop is truthy, it renders the `<ErrorDisplay />` sub-component, showing the error message and a retry option (which reloads the page).

### 2. Loading State
*   If `isLoading` is true, it renders the `<LoadingSpinner />` sub-component with a message (either `streamingProgress` or a default "Analyzing your audio...").
*   If `isStreaming` is also true during loading, it displays an additional "Streaming Analysis Active" indicator with the current `streamingProgress` message.

### 3. Results State (Streaming or Complete)
*   This is the primary display mode, active if:
    *   `isStreaming` is true AND `partialResults` has data, OR
    *   `isStreaming` is false AND `analysisResults` has data.
*   **`currentResults`**: A variable is assigned either `partialResults` (if streaming) or `analysisResults` (if not streaming or streaming is complete) to determine the data source for rendering.
*   **No Results Placeholder**: If `currentResults` is empty, a placeholder message "Ready to Analyze" is shown with some introductory text.
*   **Streaming/Completion Headers**:
    *   If `isStreaming`, a header indicates "Real-time Analysis" and shows the count of received components and the current `streamingProgress`.
    *   If `!isStreaming` and `analysisResults` exist, a header indicates "Analysis Complete".
*   **Main Content (`<ErrorBoundary>` wrapped `div.results-content`)**:
    *   This section renders various analysis parts, often wrapped in `ErrorBoundary` components to prevent a crash in one section from affecting others.
    *   Components are animated in (e.g., `animate-fadeIn`, `animate-slideInFromLeft`).
    *   **Key Highlights**: `<KeyHighlightsSection analysisResults={currentResults} />` is shown if `hasResults` is true.
    *   **Individual Streaming Components**: When `isStreaming`, several sections appear conditionally as their data arrives in `currentResults` (which is `partialResults`). These sections are styled to indicate they are part of a streaming update and highlight the `lastReceivedComponent`.
        *   Audio Quality (`currentResults.audio_quality`)
        *   Transcript (`currentResults.transcript`)
        *   Emotion Analysis (`currentResults.emotion_analysis`)
        *   Linguistic Analysis (`currentResults.linguistic_analysis`)
    *   **Comprehensive Analysis**: `<ComprehensiveAnalysisSection analysisResults={currentResults} />` is shown if `currentResults.gemini_analysis` exists.
    *   **Tabbed Secondary Analysis**: `<TabbedSecondarySection analysisResults={currentResults} />` is shown if `currentResults.secondary_analysis` exists.
    *   **Session History & Insights (Non-Streaming)**: When `!isStreaming` and `analysisResults` are available:
        *   `<SessionHistorySection ... />`
        *   `<SessionInsightsSection ... />`
*   **Data Diagnostic Panel**: `<DataDiagnosticPanel />` is rendered for debugging purposes (likely intended for development).
*   **Validation Status**: `<ValidationStatus />` displays analysis completeness or issues.
*   **Legacy Sections**: Includes fallback rendering for `transcript` if `speaker_transcripts` is missing, ensuring backward compatibility.

### Helper Components
*   **`ScoreDisplay`**: A local helper component to display a label and a formatted score with an optional unit (e.g., "%", "WPM").
*   **`ListItem`**: A local helper for rendering list items with specific styling.
*   **`SummaryItem`**: A local helper for rendering key-value pairs, stringifying object values.

---

## Usage of Sub-Components (from `./results/`)

The `ResultsDisplay` orchestrates several more specialized sub-components:
*   **`KeyHighlightsSection`**: Displays a summary or key takeaways from the analysis.
*   **`ComprehensiveAnalysisSection`**: Likely shows detailed results from the main Gemini analysis. It receives a `fillerWordFrequencyText` prop calculated in `ResultsDisplay`.
*   **`SessionInsightsSection`**: Displays insights generated based on session history and current analysis.
*   **`SessionHistorySection`**: Displays past analysis entries for the current session.
*   **`TabbedSecondarySection`**: Likely provides a tabbed interface for less primary analysis sections or related data.
*   **`DataDiagnosticPanel`**: A debugging tool to inspect raw data.
*   **`LoadingSpinner`**: A visual indicator for loading states.
*   **`ErrorDisplay`**: A standardized way to show error messages.
*   **`ErrorBoundary`**: Wraps sections to catch rendering errors within them.
*   **`ValidationStatus`**: Shows the completeness/validation status of the results.

---

## Styling and Animations

*   The component uses CSS classes defined in `ResultsDisplay.css` for overall structure and specific section styling (e.g., `.results-display-container`, `.results-section`, `.score-item`).
*   Tailwind CSS classes are also heavily used within the JSX for layout, typography, colors, and effects (e.g., `bg-blue-500/20`, `backdrop-blur-sm`, `rounded-lg`, `animate-pulse`).
*   Animations like `animate-fadeIn` and `animate-slideInFromLeft` are applied to sections for visual appeal as results appear.
*   During streaming, components that have `just-received` (based on `lastReceivedComponent` prop) get a distinct highlight.

---

## Data Transformation / Formatting

*   **`currentResults`**: Logic to select between `partialResults` (during streaming) and `analysisResults` (for complete/non-streaming results).
*   **Filler Word Frequency**: Calculates `fillerWordFrequencyText` from `analysisResults.linguistic_analysis` before passing it to `ComprehensiveAnalysisSection`.
*   The component passes down raw data structures to most sub-components, which are then responsible for their own internal rendering and formatting. Helper components like `ScoreDisplay` handle basic formatting of scores.

---
